/* jshint forin:true, noarg:true, noempty:true, eqeqeq:true, boss:true, undef:true, curly:true, browser:true, jquery:true */
/*
 * jQuery MultiSelect UI Widget 1.12
 * Copyright (c) 2011 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2+
 *   - jQuery UI 1.8 widget factory
 *
 * Optional:
 *   - jQuery UI effects
 *   - jQuery UI position utility
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
*/
(function(a,b){var c=0;a.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:"",hide:"",autoOpen:!1,multiple:!0,position:{}},_create:function(){var b=this.element.hide(),c=this.options;this.speed=a.fx.speeds._default,this._isOpen=!1;var d=(this.button=a('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(c.classes).attr({title:b.attr("title"),"aria-haspopup":!0,tabIndex:b.attr("tabIndex")}).insertAfter(b),e=(this.buttonlabel=a("<span />")).html(c.noneSelectedText).appendTo(d),f=(this.menu=a("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(c.classes).appendTo(document.body),g=(this.header=a("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(f),h=(this.headerLinkContainer=a("<ul />")).addClass("ui-helper-reset").html(function(){return c.header===!0?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+c.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+c.uncheckAllText+"</span></a></li>":typeof c.header=="string"?"<li>"+c.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(g),i=(this.checkboxContainer=a("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(f);this._bindEvents(),this.refresh(!0),c.multiple||f.addClass("ui-multiselect-single")},_init:function(){this.options.header===!1&&this.header.hide(),this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide(),this.options.autoOpen&&this.open(),this.element.is(":disabled")&&this.disable()},refresh:function(b){var d=this.element,e=this.options,f=this.menu,g=this.checkboxContainer,h=[],i=[],j=d.attr("id")||c++;d.find("option").each(function(b){var c=a(this),d=this.parentNode,f=this.innerHTML,g=this.title,k=this.value,l=this.id||"ui-multiselect-"+j+"-option-"+b,m=this.disabled,n=this.selected,p=["ui-corner-all"],q;d.tagName.toLowerCase()==="optgroup"&&(q=d.getAttribute("label"),a.inArray(q,h)===-1&&(i.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+q+"</a></li>"),h.push(q))),m&&p.push("ui-state-disabled"),n&&!e.multiple&&p.push("ui-state-active"),i.push('<li class="'+(m?"ui-multiselect-disabled":"")+'">'),i.push('<label for="'+l+'" title="'+g+'" class="'+p.join(" ")+'">'),i.push('<input id="'+l+'" name="multiselect_'+j+'" type="'+(e.multiple?"checkbox":"radio")+'" value="'+k+'" title="'+f+'"'),n&&(i.push(' checked="checked"'),i.push(' aria-selected="true"')),m&&(i.push(' disabled="disabled"'),i.push(' aria-disabled="true"')),i.push(" /><span>"+f+"</span></label></li>")}),g.html(i.join("")),this.labels=f.find("label"),this._setButtonWidth(),this._setMenuWidth(),this.button[0].defaultValue=this.update(),b||this._trigger("refresh")},update:function(){var b=this.options,c=this.labels.find("input"),d=c.filter("[checked]"),e=d.length,f;return e===0?f=b.noneSelectedText:a.isFunction(b.selectedText)?f=b.selectedText.call(this,e,c.length,d.get()):/\d/.test(b.selectedList)&&b.selectedList>0&&e<=b.selectedList?f=d.map(function(){return a(this).next().text()}).get().join(", "):f=b.selectedText.replace("#",e).replace("#",c.length),this.buttonlabel.html(f),f},_bindEvents:function(){function d(){return b[b._isOpen?"close":"open"](),!1}var b=this,c=this.button;c.find("span").bind("click.multiselect",d),c.bind({click:d,keypress:function(a){switch(a.which){case 27:case 38:case 37:b.close();break;case 39:case 40:b.open()}},mouseenter:function(){c.hasClass("ui-state-disabled")||a(this).addClass("ui-state-hover")},mouseleave:function(){a(this).removeClass("ui-state-hover")},focus:function(){c.hasClass("ui-state-disabled")||a(this).addClass("ui-state-focus")},blur:function(){a(this).removeClass("ui-state-focus")}}),this.header.delegate("a","click.multiselect",function(c){a(this).hasClass("ui-multiselect-close")?b.close():b[a(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"](),c.preventDefault()}),this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(c){c.preventDefault();var d=a(this),e=d.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),f=e.get(),g=d.parent().text();if(b._trigger("beforeoptgrouptoggle",c,{inputs:f,label:g})===!1)return;b._toggleChecked(e.filter("[checked]").length!==e.length,e),b._trigger("optgrouptoggle",c,{inputs:f,label:g,checked:f[0].checked})}).delegate("label","mouseenter.multiselect",function(){a(this).hasClass("ui-state-disabled")||(b.labels.removeClass("ui-state-hover"),a(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(c){c.preventDefault();switch(c.which){case 9:case 27:b.close();break;case 38:case 40:case 37:case 39:b._traverse(c.which,this);break;case 13:a(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(c){var d=a(this),e=this.value,f=this.checked,g=b.element.find("option");if(this.disabled||b._trigger("click",c,{value:e,text:this.title,checked:f})===!1){c.preventDefault();return}d.focus(),d.attr("aria-selected",f),g.each(function(){this.value===e?this.selected=f:b.options.multiple||(this.selected=!1)}),b.options.multiple||(b.labels.removeClass("ui-state-active"),d.closest("label").toggleClass("ui-state-active",f),b.close()),b.element.trigger("change"),setTimeout(a.proxy(b.update,b),10)}),a(document).bind("mousedown.multiselect",function(c){b._isOpen&&!a.contains(b.menu[0],c.target)&&!a.contains(b.button[0],c.target)&&c.target!==b.button[0]&&b.close()}),a(this.element[0].form).bind("reset.multiselect",function(){setTimeout(a.proxy(b.refresh,b),10)})},_setButtonWidth:function(){var a=this.element.outerWidth(),b=this.options;/\d/.test(b.minWidth)&&a<b.minWidth&&(a=b.minWidth),this.button.width(a)},_setMenuWidth:function(){var a=this.menu,b=this.button.outerWidth()-parseInt(a.css("padding-left"),10)-parseInt(a.css("padding-right"),10)-parseInt(a.css("border-right-width"),10)-parseInt(a.css("border-left-width"),10);a.width(b||this.button.outerWidth())},_traverse:function(b,c){var d=a(c),e=b===38||b===37,f=d.parent()[e?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[e?"last":"first"]();if(!f.length){var g=this.menu.find("ul").last();this.menu.find("label")[e?"last":"first"]().trigger("mouseover"),g.scrollTop(e?g.height():0)}else f.find("label").trigger("mouseover")},_toggleState:function(a,b){return function(){this.disabled||(this[a]=b),b?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(b,c){var d=c&&c.length?c:this.labels.find("input"),e=this;d.each(this._toggleState("checked",b)),d.eq(0).focus(),this.update();var f=d.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&a.inArray(this.value,f)>-1&&e._toggleState("selected",b).call(this)}),d.length&&this.element.trigger("change")},_toggleDisabled:function(a){this.button.attr({disabled:a,"aria-disabled":a})[a?"addClass":"removeClass"]("ui-state-disabled"),this.menu.find("input").attr({disabled:a,"aria-disabled":a}).parent()[a?"addClass":"removeClass"]("ui-state-disabled"),this.element.attr({disabled:a,"aria-disabled":a})},open:function(b){var c=this,d=this.button,e=this.menu,f=this.speed,g=this.options;if(this._trigger("beforeopen")===!1||d.hasClass("ui-state-disabled")||this._isOpen)return;var h=e.find("ul").last(),i=g.show,j=d.offset();a.isArray(g.show)&&(i=g.show[0],f=g.show[1]||c.speed),h.scrollTop(0).height(g.height),a.ui.position&&!a.isEmptyObject(g.position)?(g.position.of=g.position.of||d,e.show().position(g.position).hide().show(i,f)):e.css({top:j.top+d.outerHeight(),left:j.left}).show(i,f),this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus"),d.addClass("ui-state-active"),this._isOpen=!0,this._trigger("open")},close:function(){if(this._trigger("beforeclose")===!1)return;var b=this.options,c=b.hide,d=this.speed;a.isArray(b.hide)&&(c=b.hide[0],d=b.hide[1]||this.speed),this.menu.hide(c,d),this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave"),this._isOpen=!1,this._trigger("close")},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(a){this._toggleChecked(!0),this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1),this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter("[checked]")},destroy:function(){return a.Widget.prototype.destroy.call(this),this.button.remove(),this.menu.remove(),this.element.show(),this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},_setOption:function(b,c){var d=this.menu;switch(b){case"header":d.find("div.ui-multiselect-header")[c?"show":"hide"]();break;case"checkAllText":d.find("a.ui-multiselect-all span").eq(-1).text(c);break;case"uncheckAllText":d.find("a.ui-multiselect-none span").eq(-1).text(c);break;case"height":d.find("ul").last().height(parseInt(c,10));break;case"minWidth":this.options[b]=parseInt(c,10),this._setButtonWidth(),this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[b]=c,this.update();break;case"classes":d.add(this.button).removeClass(this.options.classes).addClass(c)}a.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);